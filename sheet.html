<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LINECONIC LIVE</title>
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/2.0.4/qrcode.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Space+Mono:wght@400;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{--bk:#000;--cy:#00FFFF;--pk:#FF007F;--wh:#FFF;--gd:#FFD700}
html,body{width:100vw;height:100vh;overflow:hidden;background:var(--bk);font-family:'Anton','Impact',sans-serif;cursor:none}
#deck{width:100%;height:100%;position:relative}

/* ── SLIDES ── */
.S{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--bk);opacity:0;pointer-events:none;will-change:transform,opacity;overflow:visible}
.S.on{opacity:1;pointer-events:all}

/* ── TRANSITIONS ── */
.S.t-slam{animation:slam .18s cubic-bezier(.2,1,.3,1) both}
.S.t-breath{animation:breath .8s ease-out both}
.S.t-punch{animation:punch .3s cubic-bezier(.2,1,.3,1) both}
.S.t-fade{animation:fadeIn .5s ease both}
.S.t-shake{animation:shakeIn .4s ease both}
@keyframes slam{0%{opacity:0;transform:scale(1.15)}100%{opacity:1;transform:scale(1)}}
@keyframes breath{0%{opacity:0;transform:scale(.97)}100%{opacity:1;transform:scale(1)}}
@keyframes punch{0%{opacity:0;transform:scale(.85)}60%{opacity:1;transform:scale(1.03)}100%{transform:scale(1)}}
@keyframes fadeIn{0%{opacity:0}100%{opacity:1}}
@keyframes shakeIn{0%{opacity:0;transform:translateX(-8px)}20%{transform:translateX(6px)}40%{transform:translateX(-4px)}60%{transform:translateX(2px)}80%{transform:translateX(-1px)}100%{opacity:1;transform:translateX(0)}}

/* ── TYPOGRAPHY ── */
.D{font-family:'Anton','Impact',sans-serif;text-transform:uppercase;text-align:center;line-height:1.05;letter-spacing:.04em}
.M{font-family:'Space Mono','Consolas',monospace;text-transform:uppercase;text-align:center;line-height:1.5;letter-spacing:.02em}

/* ── HALATION ── */
.hw{color:var(--wh);text-shadow:0 0 10px rgba(255,255,255,.9),0 0 30px rgba(255,255,255,.5),0 0 60px rgba(255,255,255,.2),0 0 100px rgba(255,255,255,.08)}
.hc{color:var(--cy);text-shadow:0 0 10px rgba(0,255,255,.9),0 0 30px rgba(0,255,255,.5),0 0 60px rgba(0,255,255,.2),0 0 100px rgba(0,255,255,.08)}
.hp{color:var(--pk);text-shadow:0 0 10px rgba(255,0,127,.9),0 0 30px rgba(255,0,127,.5),0 0 60px rgba(255,0,127,.2),0 0 100px rgba(255,0,127,.08)}
.hg{color:var(--gd);text-shadow:0 0 10px rgba(255,215,0,.9),0 0 30px rgba(255,215,0,.5),0 0 60px rgba(255,215,0,.2),0 0 100px rgba(255,215,0,.08)}
.hs{color:var(--wh);text-shadow:0 0 8px rgba(255,255,255,.6),0 0 20px rgba(255,255,255,.3)}

/* ── NEON BORDERS ── */
.nb{position:absolute;pointer-events:none}
.nb-pk{inset:24px;border:2px solid var(--pk);box-shadow:0 0 8px rgba(255,0,127,.8),0 0 20px rgba(255,0,127,.5),0 0 40px rgba(255,0,127,.25),inset 0 0 8px rgba(255,0,127,.3),inset 0 0 20px rgba(255,0,127,.1)}
.nb-cy{inset:24px;border:2px solid var(--cy);box-shadow:0 0 8px rgba(0,255,255,.8),0 0 20px rgba(0,255,255,.5),0 0 40px rgba(0,255,255,.25),inset 0 0 8px rgba(0,255,255,.3),inset 0 0 20px rgba(0,255,255,.1)}
.nb-wh{inset:24px;border:1px solid rgba(255,255,255,.5);box-shadow:0 0 4px rgba(255,255,255,.2)}
.nb-gd{inset:24px;border:2px solid var(--gd);box-shadow:0 0 8px rgba(255,215,0,.8),0 0 20px rgba(255,215,0,.5),0 0 40px rgba(255,215,0,.25),inset 0 0 8px rgba(255,215,0,.3)}

/* ── TIMER BORDER (replaces neon border) ── */
.tb{position:absolute;inset:22px;pointer-events:none;border:3px solid transparent;opacity:0;transition:opacity .2s;z-index:2}
.tb.active{opacity:1}
.tb.active~.nb,.S:has(.tb.active) .nb{opacity:0!important;transition:opacity .15s}
.tb.pk{background:conic-gradient(from 0deg,var(--pk) var(--tp,100%),rgba(255,0,127,.15) var(--tp,100%)) border-box;-webkit-mask:linear-gradient(#fff 0 0) padding-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;box-shadow:0 0 20px rgba(255,0,127,.8),0 0 40px rgba(255,0,127,.3)}
.tb.cy{background:conic-gradient(from 0deg,var(--cy) var(--tp,100%),rgba(0,255,255,.15) var(--tp,100%)) border-box;-webkit-mask:linear-gradient(#fff 0 0) padding-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;box-shadow:0 0 20px rgba(0,255,255,.8),0 0 40px rgba(0,255,255,.3)}
.tb.dead{animation:tbDie .5s ease-out both}
.tb.dead~.nb,.S:has(.tb.dead) .nb{opacity:0!important}
@keyframes tbDie{0%{opacity:1;box-shadow:0 0 30px rgba(255,0,127,1)}100%{opacity:0;box-shadow:none}}

/* ── SCOREBOARD ── */
#sbug{position:fixed;bottom:0;left:0;right:0;height:48px;display:flex;justify-content:center;align-items:center;gap:40px;font-family:'Space Mono',monospace;font-size:14px;letter-spacing:.08em;text-transform:uppercase;z-index:90;opacity:0;transition:opacity .3s;pointer-events:none;background:linear-gradient(transparent,rgba(0,0,0,.8))}
#sbug.on{opacity:1}
#sbug .team{display:flex;align-items:center;gap:10px}
#sbug .lbl{color:rgba(255,255,255,.4);font-size:11px}
#sbug .sc-cy{color:var(--cy);text-shadow:0 0 8px rgba(0,255,255,.6);font-size:18px;font-weight:700;min-width:30px;text-align:center}
#sbug .sc-pk{color:var(--pk);text-shadow:0 0 8px rgba(255,0,127,.6);font-size:18px;font-weight:700;min-width:30px;text-align:center}
#sbug .vs{color:rgba(255,255,255,.2);font-size:10px}

/* ── MISC ── */
.srcbar{position:absolute;bottom:40px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.9);padding:8px 28px;font-family:'Space Mono',monospace;font-size:clamp(10px,1.2vw,15px);color:rgba(255,255,255,.5);text-transform:uppercase;letter-spacing:.06em}
.rule{width:50%;height:1px;background:rgba(255,255,255,.3);margin:12px auto}
.ans-list{font-family:'Space Mono',monospace;text-align:center;line-height:2;padding:3% 8%;width:100%;overflow-y:auto;max-height:80vh}
.ans-list div{color:var(--wh);text-shadow:0 0 6px rgba(255,255,255,.3);font-size:clamp(12px,1.8vw,20px)}
.ans-list .bonus{color:var(--gd);text-shadow:0 0 6px rgba(255,215,0,.4)}
@keyframes pulse{0%,100%{opacity:.8;filter:brightness(1)}50%{opacity:1;filter:brightness(1.3)}}
@keyframes rain{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}
@keyframes crateGlow{0%,100%{box-shadow:0 0 40px rgba(255,0,127,.4),0 0 80px rgba(255,0,127,.2)}50%{box-shadow:0 0 60px rgba(255,0,127,.7),0 0 120px rgba(255,0,127,.4)}}
@keyframes crateFloat{0%{transform:translateY(-120vh) rotate(-5deg)}60%{transform:translateY(0) rotate(2deg)}75%{transform:translateY(-3vh) rotate(-1deg)}90%{transform:translateY(1vh) rotate(.5deg)}100%{transform:translateY(0) rotate(0)}}
@keyframes crateLidOpen{0%{transform-origin:left center;transform:perspective(800px) rotateY(0)}100%{transform-origin:left center;transform:perspective(800px) rotateY(-110deg)}}
@keyframes crateGlowReveal{0%{opacity:0;transform:scale(.9)}100%{opacity:1;transform:scale(1)}}

/* Crate animations only play when slide is active */
.S:not(.on) .crate,.S:not(.on) .crate-lid,.S:not(.on) .crate-interior,.S:not(.on) .crate-L{animation-play-state:paused!important}

/* ── PARTICLE CANVAS ── */
#particles{position:fixed;inset:0;pointer-events:none;z-index:80}

/* ── CRATE DROP ── */
.crate-container{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:3}
.crate{width:clamp(180px,20vw,300px);height:clamp(120px,14vw,200px);position:relative;animation:crateFloat 1.2s cubic-bezier(.22,.68,.36,1) both}
.crate-body{width:100%;height:100%;background:#0a0a0a;border:2px solid rgba(255,0,127,.6);position:relative;animation:crateGlow 2s ease-in-out infinite 1.4s}
.crate-lid{width:100%;height:20px;background:#0a0a0a;border:2px solid rgba(255,0,127,.6);border-bottom:none;position:absolute;top:-20px;left:0;animation:crateLidOpen .6s ease-out 1.8s both}
.crate-interior{position:absolute;inset:3px;background:var(--pk);opacity:0;animation:crateGlowReveal .4s ease-out 2s both}
.crate-L{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Anton',sans-serif;font-size:clamp(48px,8vw,80px);color:#0a0a0a;opacity:0;animation:crateGlowReveal .3s ease 2.2s both}
#ctr{position:fixed;bottom:4px;right:8px;font-family:'Space Mono',monospace;font-size:9px;color:rgba(255,255,255,.08);z-index:100;pointer-events:none}
#sec{position:fixed;top:4px;left:8px;font-family:'Space Mono',monospace;font-size:9px;color:rgba(255,255,255,.06);z-index:100;pointer-events:none;text-transform:uppercase;letter-spacing:.1em}

/* ── HOST PANEL ── */
#host{position:fixed;top:0;left:0;width:360px;height:100%;background:rgba(0,0,0,.95);border-right:1px solid rgba(255,255,255,.1);padding:16px;font-family:'Space Mono',monospace;font-size:11px;color:rgba(255,255,255,.6);z-index:200;transform:translateX(-100%);transition:transform .2s;overflow-y:auto;overflow-x:hidden}
#host.on{transform:translateX(0)}
#host h3{color:var(--pk);font-size:10px;letter-spacing:.1em;margin:16px 0 6px;text-transform:uppercase}
#host .hint{color:var(--cy);font-size:12px;margin:4px 0}
#host .next{color:rgba(255,255,255,.3);font-size:10px;margin:4px 0}
#host input{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);color:var(--wh);padding:4px 8px;width:50px;font-family:'Space Mono',monospace;font-size:14px;text-align:center;margin:0 4px}
#host button{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);color:var(--wh);padding:6px 10px;font-family:'Space Mono',monospace;font-size:9px;cursor:pointer;text-transform:uppercase;letter-spacing:.05em;margin:0;white-space:nowrap}
#host button:hover{background:rgba(255,255,255,.2)}
#host .dur-btn.active{background:rgba(255,0,127,.3);border-color:var(--pk);color:var(--pk)}
</style>
</head>
<body>
<div id="deck"></div>
<canvas id="particles"></canvas>
<div id="ctr"></div>
<div id="sec"></div>
<div id="sbug">
  <div class="team"><span class="lbl">CYAN</span><span class="sc-cy" id="sc0">0</span></div>
  <div class="vs">VS</div>
  <div class="team"><span class="sc-pk" id="sc1">0</span><span class="lbl">PINK</span></div>
</div>
<div id="host">
  <div style="color:var(--pk);font-size:13px;letter-spacing:.15em;margin-bottom:16px;border-bottom:1px solid rgba(255,0,127,.3);padding-bottom:12px">HOST CONTROLS</div>

  <!-- NOW PLAYING -->
  <h3>NOW PLAYING</h3>
  <div id="h-type" style="color:var(--wh);font-size:12px"></div>
  <div id="h-answer" class="hint"></div>
  <div id="h-next" class="next" style="margin-top:6px"></div>

  <div style="height:1px;background:rgba(255,255,255,.06);margin:14px 0"></div>

  <!-- SCOREBOARD -->
  <h3>SCOREBOARD</h3>
  <div style="display:flex;align-items:center;gap:6px;margin:6px 0">
    <span style="color:var(--cy);font-size:10px;width:40px">CYAN</span>
    <input id="si0" type="number" value="0">
    <button id="u0">SET</button>
  </div>
  <div style="display:flex;align-items:center;gap:6px;margin:6px 0">
    <span style="color:var(--pk);font-size:10px;width:40px">PINK</span>
    <input id="si1" type="number" value="0">
    <button id="u1">SET</button>
  </div>
  <button id="stog" onclick="toggleScore()" style="margin-top:6px">SHOW SCOREBOARD</button>

  <div style="height:1px;background:rgba(255,255,255,.06);margin:14px 0"></div>

  <!-- TIMER -->
  <h3>TIMER</h3>
  <div style="display:flex;gap:4px;margin-bottom:8px">
    <button class="dur-btn" data-dur="10" onclick="setDur(10)">10s</button>
    <button class="dur-btn active" data-dur="30" onclick="setDur(30)">30s</button>
    <button class="dur-btn" data-dur="60" onclick="setDur(60)">60s</button>
  </div>
  <div style="display:flex;gap:4px">
    <button onclick="startTimer(autoSec)" style="flex:1">START</button>
    <button id="pbtn" onclick="togglePause()" style="flex:1">PAUSE</button>
    <button onclick="stopTimer()" style="flex:1">STOP</button>
  </div>
  <div style="display:flex;gap:4px;margin-top:8px">
    <button id="atbtn" onclick="toggleAutoTimer()" style="flex:1">AUTO-TIMER: OFF</button>
    <button id="aabtn" onclick="toggleAutoAdv()" style="flex:1">AUTO-ADVANCE: OFF</button>
  </div>

  <div style="height:1px;background:rgba(255,255,255,.06);margin:14px 0"></div>

  <!-- AUDIO -->
  <h3>AUDIO</h3>
  <button id="mbtn" onclick="toggleMute()">UNMUTE AUDIO</button>

  <div style="height:1px;background:rgba(255,255,255,.06);margin:14px 0"></div>

  <!-- DOA VOTING -->
  <h3>DEAD OR ALIVE</h3>
  <div style="display:flex;gap:4px;margin-bottom:6px">
    <button id="vdead" onclick="castVote('dead')" style="flex:1;color:var(--pk);border-color:rgba(255,0,127,.4)">+ DEAD</button>
    <button id="valive" onclick="castVote('alive')" style="flex:1;color:var(--cy);border-color:rgba(0,255,255,.4)">+ ALIVE</button>
  </div>
  <div style="display:flex;gap:4px;margin-bottom:6px">
    <button onclick="for(let i=0;i<5;i++)castVote('dead')" style="flex:1;font-size:8px">+5 DEAD</button>
    <button onclick="for(let i=0;i<5;i++)castVote('alive')" style="flex:1;font-size:8px">+5 ALIVE</button>
  </div>
  <div id="h-votes" style="color:rgba(255,255,255,.4);font-size:9px;margin:4px 0">DEAD: 0 | ALIVE: 0 | TOTAL: 0</div>
  <button onclick="resetVotes()" style="font-size:8px;margin-top:4px">RESET VOTES</button>

  <div style="height:1px;background:rgba(255,255,255,.06);margin:14px 0"></div>

  <!-- SHORTCUTS -->
  <h3 style="color:rgba(255,255,255,.2)">SHORTCUTS</h3>
  <div style="line-height:1.8;color:rgba(255,255,255,.2);font-size:9px">
    ARROW / SPACE / CLICK = next<br>
    H = this panel<br>
    S = scoreboard<br>
    T = start timer<br>
    P = pause / resume<br>
    F = fullscreen<br>
    M = mute / unmute<br>
    A = auto-timer<br>
    D = auto-advance
  </div>
</div>

<script>
// ═════════════════════════════════════════
// DATA
// ═════════════════════════════════════════
const S=[{"slide_type":"attract","section":"PRE-SHOW","primary_text":"L","secondary_text":""},{"slide_type":"fishbowl","section":"WARM-UP","primary_text":"WRITE YOUR RED FLAG.","secondary_text":"DROP IT IN THE BOWL. WE WILL USE IT AGAINST YOU."},{"slide_type":"round_title","section":"ROUND 1: GUESS THE SOURCE","primary_text":"ROUND 1","secondary_text":"GUESS THE SOURCE"},{"slide_type":"tier_title","section":"ROUND 1: GUESS THE SOURCE","primary_text":"WE SHOW THE LINE. YOU WRITE WHERE IT'S FROM.","secondary_text":"Q1-Q4: 1 POINT | Q5 BONUS: 3 POINTS | Q6-Q9: 1 POINT | Q10 BONUS: 5 POINTS | Q11-Q14: 1 POINT | Q15 BONUS: 10 POINTS"},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"DID I STUTTER?","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"I AM IRON MAN","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"HASTA LA VISTA, BABY","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"I KISSED A GIRL","secondary_text":""},{"slide_type":"bonus_marker","section":"ROUND 1: GUESS THE SOURCE","primary_text":"BONUS: 3 POINTS","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"SHUT UP AND TAKE MY MONEY","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"TO INFINITY AND BEYOND","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"I SEE DEAD PEOPLE","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"I WILL ALWAYS LOVE YOU","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"WHO LET THE DOGS OUT","secondary_text":""},{"slide_type":"bonus_marker","section":"ROUND 1: GUESS THE SOURCE","primary_text":"BONUS: 5 POINTS","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"PARTY ROCK IS IN THE HOUSE TONIGHT","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"MAY THE FORCE BE WITH YOU","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"HIT ME BABY ONE MORE TIME","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"I'M GONNA TAKE MY HORSE TO THE OLD TOWN ROAD","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"LOOK WHAT YOU MADE ME DO","secondary_text":""},{"slide_type":"bonus_marker","section":"ROUND 1: GUESS THE SOURCE","primary_text":"BONUS: 10 POINTS","secondary_text":""},{"slide_type":"source_q","section":"ROUND 1: GUESS THE SOURCE","primary_text":"GOODBYE YELLOW BRICK ROAD","secondary_text":""},{"slide_type":"score","section":"ROUND 1: GUESS THE SOURCE","primary_text":"ROUND 1 COMPLETE","secondary_text":"SWAP SCORECARDS. MARK THEM."},{"slide_type":"answer_sheet","section":"ROUND 1: GUESS THE SOURCE","primary_text":"GUESS THE SOURCE : ANSWERS","secondary_text":"1. THE OFFICE|2. AVENGERS|3. TERMINATOR 2|4. KATY PERRY|5. FUTURAMA [3pts]|6. TOY STORY|7. THE SIXTH SENSE|8. WHITNEY HOUSTON|9. BAHA MEN|10. LMFAO [5pts]|11. STAR WARS|12. BRITNEY SPEARS|13. LIL NAS X|14. TAYLOR SWIFT|15. ELTON JOHN [10pts]"},{"slide_type":"crate_drop","section":"ROUND 1: GUESS THE SOURCE","primary_text":"","secondary_text":""},{"slide_type":"round_title","section":"ROUND 2: SCREEN","primary_text":"ROUND 2","secondary_text":"GUESS THE LINECONIC: SCREEN"},{"slide_type":"tier_title","section":"ROUND 2: SCREEN","primary_text":"WE SHOW THE ACRONYM. YOU DECODE THE LINE. CINEMA & TV ONLY.","secondary_text":"Q1-Q4: 1 POINT | Q5 BONUS: 3 POINTS | Q6-Q9: 1 POINT | Q10 BONUS: 5 POINTS | Q11-Q14: 1 POINT | Q15 BONUS: 10 POINTS"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"I.A.K.","secondary_text":"Barbie"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"N.T.N.S.","secondary_text":"RuPaul's Drag Race"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"Y.F.","secondary_text":"The Apprentice"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"W.F.","secondary_text":"Black Panther"},{"slide_type":"bonus_marker","section":"ROUND 2: SCREEN","primary_text":"BONUS: 3 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"N.S.F.Y.","secondary_text":"Seinfeld"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"S.H.T.M.L.F.","secondary_text":"Scarface"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"M.V.","secondary_text":"RuPaul's Drag Race"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"B.J.B.","secondary_text":"007"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"T.Y.S.","secondary_text":"Parks and Recreation"},{"slide_type":"bonus_marker","section":"ROUND 2: SCREEN","primary_text":"BONUS: 5 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"W.A.Y.T.W.T.Y.A.","secondary_text":"The Office"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"G.T.T.C.","secondary_text":"Predator"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"Y.C.H.T.T.","secondary_text":"A Few Good Men"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"T.N.P.L.H.","secondary_text":"The Wizard of Oz"},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"H.L.A.Y.K.","secondary_text":"Casablanca"},{"slide_type":"bonus_marker","section":"ROUND 2: SCREEN","primary_text":"BONUS: 10 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 2: SCREEN","primary_text":"I.H.W.S.H.","secondary_text":"When Harry Met Sally"},{"slide_type":"score","section":"ROUND 2: SCREEN","primary_text":"ROUND 2 COMPLETE","secondary_text":"SWAP SCORECARDS. MARK THEM."},{"slide_type":"answer_sheet","section":"ROUND 2: SCREEN","primary_text":"SCREEN : ANSWERS","secondary_text":"1. I AM KENOUGH : Barbie|2. NO TEA NO SHADE : RuPaul's Drag Race|3. YOU'RE FIRED! : The Apprentice|4. WAKANDA FOREVER : Black Panther|5. NO SOUP FOR YOU : Seinfeld [3pts]|6. SAY HELLO TO MY LITTLE FRIEND : Scarface|7. MISS VANJIE : RuPaul's Drag Race|8. BOND. JAMES BOND. : 007|9. TREAT YO SELF : Parks and Recreation|10. WHY ARE YOU THE WAY THAT YOU ARE : The Office [5pts]|11. GET TO THE CHOPPER : Predator|12. YOU CAN'T HANDLE THE TRUTH! : A Few Good Men|13. THERE'S NO PLACE LIKE HOME : The Wizard of Oz|14. HERE'S LOOKING AT YOU KID : Casablanca|15. I'LL HAVE WHAT SHE'S HAVING : When Harry Met Sally [10pts]"},{"slide_type":"crate_drop","section":"ROUND 2: SCREEN","primary_text":"","secondary_text":""},{"slide_type":"round_title","section":"FLUENCY CHECK","primary_text":"FLUENCY CHECK","secondary_text":"WE SHOW THE LINE. YOU SHOUT THE SOURCE. NO WRITING. NO SCORING."},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"ALRIGHT, ALRIGHT, ALRIGHT","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"DAZED AND CONFUSED","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"IT'S BRITNEY, BITCH","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"BRITNEY SPEARS","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"ON WEDNESDAYS WE WEAR PINK","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"MEAN GIRLS","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"HOT PRIEST","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"FLEABAG","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"RUN, FORREST, RUN!","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"FORREST GUMP","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"YOU ONLY LIVE ONCE","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"DRAKE","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"HAVE YOU EVER HAD A CASE OF THE MONDAYS","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"OFFICE SPACE","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"HOUSTON, WE HAVE A PROBLEM","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"APOLLO 13","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"HI I'M JUST BEACH","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"BARBIE","secondary_text":""},{"slide_type":"fluency_line","section":"FLUENCY CHECK","primary_text":"I'LL BE BACK","secondary_text":""},{"slide_type":"fluency_source","section":"FLUENCY CHECK","primary_text":"THE TERMINATOR","secondary_text":""},{"slide_type":"transition_beat","section":"FLUENCY CHECK","primary_text":"","secondary_text":""},{"slide_type":"intermission","section":"INTERMISSION","primary_text":"INTERMISSION.","secondary_text":"10 MINUTES. GET A DRINK."},{"slide_type":"warning","section":"INTERMISSION","primary_text":"60 SECONDS.","secondary_text":""},{"slide_type":"blackout","section":"INTERMISSION","primary_text":"","secondary_text":""},{"slide_type":"round_title","section":"DEAD OR ALIVE","primary_text":"DEAD OR ALIVE","secondary_text":"CULTURALLY RELEVANT OR CULTURALLY EXPIRED. YOU DECIDE."},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"SKINNY JEANS","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"SKINNY JEANS","secondary_text":""},{"slide_type":"doa_verdict_dead","section":"DEAD OR ALIVE","primary_text":"DEAD","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"ROM COMS","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"ROM COMS","secondary_text":""},{"slide_type":"doa_verdict_alive","section":"DEAD OR ALIVE","primary_text":"ALIVE","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"LAUGH TRACKS","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"LAUGH TRACKS","secondary_text":""},{"slide_type":"doa_verdict_dead","section":"DEAD OR ALIVE","primary_text":"DEAD","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"NEPO BABIES","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"NEPO BABIES","secondary_text":""},{"slide_type":"doa_verdict_alive","section":"DEAD OR ALIVE","primary_text":"ALIVE","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"MARVEL PHASE 5","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"MARVEL PHASE 5","secondary_text":""},{"slide_type":"doa_verdict_dead","section":"DEAD OR ALIVE","primary_text":"DEAD","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"REALITY TV","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"REALITY TV","secondary_text":""},{"slide_type":"doa_verdict_alive","section":"DEAD OR ALIVE","primary_text":"ALIVE","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"METHOD ACTING","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"METHOD ACTING","secondary_text":""},{"slide_type":"doa_verdict_dead","section":"DEAD OR ALIVE","primary_text":"DEAD","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"THE OFFICE REBOOT","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"THE OFFICE REBOOT","secondary_text":""},{"slide_type":"doa_verdict_dead","section":"DEAD OR ALIVE","primary_text":"DEAD","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"A24","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"A24","secondary_text":""},{"slide_type":"doa_verdict_alive","section":"DEAD OR ALIVE","primary_text":"ALIVE","secondary_text":""},{"slide_type":"doa_ref","section":"DEAD OR ALIVE","primary_text":"MOVIE THEATRES","secondary_text":""},{"slide_type":"doa_vote","section":"DEAD OR ALIVE","primary_text":"MOVIE THEATRES","secondary_text":""},{"slide_type":"doa_verdict_alive","section":"DEAD OR ALIVE","primary_text":"ALIVE","secondary_text":""},{"slide_type":"transition_beat","section":"DEAD OR ALIVE","primary_text":"","secondary_text":""},{"slide_type":"round_title","section":"ROUND 3: LYRICS","primary_text":"ROUND 3","secondary_text":"GUESS THE LINECONIC: LYRICS"},{"slide_type":"tier_title","section":"ROUND 3: LYRICS","primary_text":"WE SHOW THE ACRONYM. YOU DECODE THE LINE. MUSIC ONLY.","secondary_text":"Q1-Q4: 1 POINT | Q5 BONUS: 3 POINTS | Q6-Q9: 1 POINT | Q10 BONUS: 5 POINTS | Q11-Q14: 1 POINT | Q15 BONUS: 10 POINTS"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"W.T.R.S.S.P.S.U.","secondary_text":"Eminem"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"T.M.W.Y.W.","secondary_text":"Spice Girls"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"H.M.B.O.M.T.","secondary_text":"Britney Spears"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"I.G.M.D.L.","secondary_text":"Olivia Rodrigo"},{"slide_type":"bonus_marker","section":"ROUND 3: LYRICS","primary_text":"BONUS: 3 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"S.U.B.G.","secondary_text":"Kelly Clarkson"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"U.C.T.T.","secondary_text":"MC Hammer"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"S.B.T.R.","secondary_text":"Eminem"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"I.I.B.","secondary_text":"Vanilla Ice"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"I.S.J.","secondary_text":"Charli XCX/Brat"},{"slide_type":"bonus_marker","section":"ROUND 3: LYRICS","primary_text":"BONUS: 5 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"S.L.B.Y.C.F.W.M.","secondary_text":"Cardi B"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"I.W.I.T.W.","secondary_text":"Backstreet Boys"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"N.S.","secondary_text":"TLC"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"G.J.W.I.","secondary_text":"Will Smith"},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"M.H.W.G.O.","secondary_text":"Celine Dion"},{"slide_type":"bonus_marker","section":"ROUND 3: LYRICS","primary_text":"BONUS: 10 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 3: LYRICS","primary_text":"C.I.L.","secondary_text":"Beyonce"},{"slide_type":"score","section":"ROUND 3: LYRICS","primary_text":"ROUND 3 COMPLETE","secondary_text":"SWAP SCORECARDS. MARK THEM."},{"slide_type":"answer_sheet","section":"ROUND 3: LYRICS","primary_text":"LYRICS : ANSWERS","secondary_text":"1. WILL THE REAL SLIM SHADY PLEASE STAND UP : Eminem|2. TELL ME WHAT YOU WANT : Spice Girls|3. HIT ME BABY ONE MORE TIME : Britney Spears|4. I GOT MY DRIVER'S LICENSE : Olivia Rodrigo|5. SINCE U BEEN GONE : Kelly Clarkson [3pts]|6. U CAN'T TOUCH THIS : MC Hammer|7. SNAP BACK TO REALITY : Eminem|8. ICE ICE BABY : Vanilla Ice|9. I'M SO JULIA : Charli XCX/Brat|10. SAID LIL BITCH YOU CANT FUCK WITH ME : Cardi B [5pts]|11. I WANT IT THAT WAY : Backstreet Boys|12. NO SCRUBS : TLC|13. GETTING JIGGY WITH IT : Will Smith|14. MY HEART WILL GO ON : Celine Dion|15. CRAZY IN LOVE : Beyonce [10pts]"},{"slide_type":"crate_drop","section":"ROUND 3: LYRICS","primary_text":"","secondary_text":""},{"slide_type":"round_title","section":"ROUND 4: MIXED","primary_text":"ROUND 4","secondary_text":"GUESS THE LINECONIC: EVERYTHING"},{"slide_type":"tier_title","section":"ROUND 4: MIXED","primary_text":"SCREEN + LYRICS. NO RESTRICTIONS. HARDEST REFERENCES.","secondary_text":"Q1-Q4: 1 POINT | Q5 BONUS: 3 POINTS | Q6-Q9: 1 POINT | Q10 BONUS: 5 POINTS | Q11-Q14: 1 POINT | Q15 BONUS: 10 POINTS"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"S.M.N.","secondary_text":"Destiny's Child"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"I.A.T.D.","secondary_text":"Breaking Bad"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"Y.G.N.A.B.B.","secondary_text":"Jaws"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"Y.C.S.W.U.","secondary_text":"Mean Girls"},{"slide_type":"bonus_marker","section":"ROUND 4: MIXED","primary_text":"BONUS: 3 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"G.I.L.W.G.S.","secondary_text":"Mean Girls"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"I.A.T.O.W.K.","secondary_text":"Breaking Bad"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"S.U.","secondary_text":"Simple Life"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"L.I.G.","secondary_text":"Frozen"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"W.A.T.","secondary_text":"Vine"},{"slide_type":"bonus_marker","section":"ROUND 4: MIXED","primary_text":"BONUS: 5 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"T.L.D.N.E.","secondary_text":"Mean Girls"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"I.V.A.T.","secondary_text":"Hunger Games"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"H.Y.D.","secondary_text":"Friends"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"N.G.G.Y.U.","secondary_text":"Rick Astley"},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"W.D.T.F.S.","secondary_text":"Ylvis"},{"slide_type":"bonus_marker","section":"ROUND 4: MIXED","primary_text":"BONUS: 10 POINTS","secondary_text":""},{"slide_type":"acronym_q","section":"ROUND 4: MIXED","primary_text":"I.S.D.P.","secondary_text":"The Sixth Sense"},{"slide_type":"score","section":"ROUND 4: MIXED","primary_text":"ROUND 4 COMPLETE","secondary_text":"SWAP SCORECARDS. MARK THEM."},{"slide_type":"answer_sheet","section":"ROUND 4: MIXED","primary_text":"MIXED : ANSWERS","secondary_text":"1. SAY MY NAME : Destiny's Child|2. I AM THE DANGER : Breaking Bad|3. YOU'RE GONNA NEED A BIGGER BOAT : Jaws|4. YOU CAN'T SIT WITH US : Mean Girls|5. GET IN LOSER WE'RE GOING SHOPPING : Mean Girls [3pts]|6. I AM THE ONE WHO KNOCKS : Breaking Bad|7. SHUT UP : Simple Life|8. LET IT GO : Frozen|9. WHAT ARE THOSE : Vine|10. THE LIMIT DOES NOT EXIST : Mean Girls [5pts]|11. I VOLUNTEER AS TRIBUTE : Hunger Games|12. HOW YOU DOIN' : Friends|13. NEVER GONNA GIVE YOU UP : Rick Astley|14. WHAT DOES THE FOX SAY : Ylvis|15. I SEE DEAD PEOPLE : The Sixth Sense [10pts]"},{"slide_type":"verdict","section":"THE VERDICT","primary_text":"THE VERDICT.","secondary_text":""},{"slide_type":"sentence","section":"THE VERDICT","primary_text":"THE SENTENCE.","secondary_text":"LOSING TABLE. IN UNISON.|'YOU CAN'T SIT WITH US': MEAN GIRLS."},{"slide_type":"receipt_rain","section":"THE VERDICT","primary_text":"MAKE IT RAIN.","secondary_text":""},{"slide_type":"last_line","section":"THE VERDICT","primary_text":"NOBODY PUTS BABY IN A CORNER.","secondary_text":""},{"slide_type":"endcard","section":"THE VERDICT","primary_text":"L","secondary_text":"STOP BEING UNCULTURED."},{"slide_type":"round_title","section":"BONUS: HOT SEAT","primary_text":"BONUS ROUND","secondary_text":"THE HOT SEAT"},{"slide_type":"hotseat_rules","section":"BONUS: HOT SEAT","primary_text":"ROOM SPLITS. WINNING TABLE SENDS A CHAMPION.","secondary_text":"BACK TO SCREEN. YOUR HALF SCREAMS CLUES.|OTHER HALF STAYS QUIET.|30 SECONDS PER PROMPT."},{"slide_type":"hotseat_prompt","section":"BONUS: HOT SEAT","primary_text":"BABY SHARK","secondary_text":""},{"slide_type":"hotseat_prompt","section":"BONUS: HOT SEAT","primary_text":"SMELLS LIKE TEEN SPIRIT","secondary_text":""},{"slide_type":"hotseat_prompt","section":"BONUS: HOT SEAT","primary_text":"NOT TODAY SATAN","secondary_text":""},{"slide_type":"hotseat_prompt","section":"BONUS: HOT SEAT","primary_text":"YOU CAN'T SIT WITH US","secondary_text":""},{"slide_type":"hotseat_prompt","section":"BONUS: HOT SEAT","primary_text":"LIFE IS LIKE A BOX OF CHOCOLATES","secondary_text":""},{"slide_type":"hotseat_prompt","section":"BONUS: HOT SEAT","primary_text":"JUST KEEP SWIMMING","secondary_text":""},{"slide_type":"score","section":"BONUS: HOT SEAT","primary_text":"HOT SEAT COMPLETE.","secondary_text":""},{"slide_type":"endcard","section":"BONUS: HOT SEAT","primary_text":"L","secondary_text":"YOU'VE BEEN LINECONIC."}];
const t=S.length;
let c=0;

// ═════════════════════════════════════════
// SOUND ENGINE (Web Audio API)
// ═════════════════════════════════════════
let actx=null,muted=true;
function initAudio(){if(!actx)try{actx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){}}

function tone(freq,dur,type,vol,ramp){
  if(muted||!actx)return;
  const o=actx.createOscillator(),g=actx.createGain();
  o.type=type||'sine';o.frequency.setValueAtTime(freq,actx.currentTime);
  g.gain.setValueAtTime(0,actx.currentTime);
  g.gain.linearRampToValueAtTime(vol||.08,actx.currentTime+.02);
  if(ramp)o.frequency.linearRampToValueAtTime(ramp,actx.currentTime+dur);
  g.gain.exponentialRampToValueAtTime(.001,actx.currentTime+dur);
  o.connect(g);g.connect(actx.destination);o.start();o.stop(actx.currentTime+dur+.05);
}

// Shepard tone (endless rising)
let shep=null;
function startShepard(){
  if(muted||!actx||shep)return;
  const L=[];
  [110,220,440,880].forEach(b=>{
    const o=actx.createOscillator(),g=actx.createGain();
    o.type='sine';o.frequency.value=b;g.gain.value=.012;
    o.connect(g);g.connect(actx.destination);o.start();
    L.push({o,g,b,f:b});
  });
  const id=setInterval(()=>{
    L.forEach(l=>{l.f*=1.003;if(l.f>1600){l.f=l.b;l.o.frequency.value=l.b;l.g.gain.setValueAtTime(0,actx.currentTime);l.g.gain.linearRampToValueAtTime(.012,actx.currentTime+.5)}else{l.o.frequency.value=l.f}});
  },50);
  shep={L,id};
}
function stopShepard(){
  if(!shep)return;clearInterval(shep.id);
  shep.L.forEach(l=>{l.g.gain.exponentialRampToValueAtTime(.001,actx.currentTime+.3);l.o.stop(actx.currentTime+.4)});
  shep=null;
}

function sfx(type){
  initAudio();
  const isQ=type==="source_q"||type==="acronym_q"||type==="hotseat_prompt";
  if(!isQ)stopShepard();
  switch(type){
    case"source_q":case"acronym_q":case"hotseat_prompt":if(!shep)startShepard();break;
    case"source_a":case"acronym_a":tone(180,.25,"triangle",.15);setTimeout(()=>tone(240,.3,"triangle",.12),80);break;
    case"bonus_marker":tone(600,.1,"square",.06);setTimeout(()=>tone(800,.1,"square",.06),100);setTimeout(()=>tone(1000,.15,"square",.08),200);break;
    case"doa_verdict_dead":tone(80,.8,"sawtooth",.1);break;
    case"doa_verdict_alive":tone(523,.12,"sine",.08);setTimeout(()=>tone(659,.12,"sine",.08),80);setTimeout(()=>tone(784,.2,"sine",.1),160);break;
    case"receipt_rain":tone(100,.6,"sawtooth",.12);setTimeout(()=>tone(150,.5,"sawtooth",.1),200);break;
    case"crate_drop":tone(60,.8,"sine",.06,30);setTimeout(()=>{tone(200,.2,"triangle",.08);tone(300,.15,"triangle",.06)},1200);setTimeout(()=>tone(523,.4,"sine",.1),1900);break;
    case"score":tone(440,.15,"sine",.06);setTimeout(()=>tone(554,.15,"sine",.06),120);setTimeout(()=>tone(659,.3,"sine",.08),240);break;
    case"round_title":tone(200,.5,"sine",.05,400);break;
    case"verdict":tone(60,1.5,"sawtooth",.08);break;
    case"last_line":tone(330,.3,"sine",.06);setTimeout(()=>tone(440,.3,"sine",.06),200);setTimeout(()=>tone(554,.5,"sine",.08),400);break;
    case"fluency_line":tone(350,.12,"sine",.05);break;
    case"doa_ref":tone(150,.3,"triangle",.07);break;
    case"doa_vote":tone(200,.2,"sine",.05);setTimeout(()=>tone(250,.2,"sine",.05),150);break;
  }
}

// ═════════════════════════════════════════
// TIMER (conic border fuse + pause/resume)
// ═════════════════════════════════════════
let tmr=null,tmrEl=null,tmrRemaining=0,tmrTotal=0,tmrPaused=false;
function startTimer(sec){
  stopTimer();
  tmrTotal=sec*1000;tmrRemaining=tmrTotal;tmrPaused=false;
  const sl=document.getElementById('s'+c);
  tmrEl=sl.querySelector('.tb');
  if(!tmrEl){tmrEl=document.createElement('div');tmrEl.className='tb pk';sl.appendChild(tmrEl)}
  tmrEl.classList.add('active');tmrEl.classList.remove('dead');
  resumeTimer();
}
function resumeTimer(){
  if(!tmrEl||tmrRemaining<=0)return;
  tmrPaused=false;
  const t0=performance.now(),startRemain=tmrRemaining;
  updatePauseBtn();
  (function tick(now){
    if(tmrPaused)return;
    const elapsed=now-t0;
    tmrRemaining=Math.max(0,startRemain-elapsed);
    const pct=tmrRemaining/tmrTotal;
    tmrEl.style.setProperty('--tp',(pct*100)+'%');
    if(tmrRemaining<=0){tmrEl.classList.add('dead');tmrEl.classList.remove('active');tone(200,.3,'square',.1);setTimeout(()=>tone(150,.3,'square',.08),150);tmr=null;if(autoAdv)setTimeout(()=>go(c+1),800);return}
    tmr=requestAnimationFrame(tick);
  })(performance.now());
}
function pauseTimer(){
  if(tmr){cancelAnimationFrame(tmr);tmr=null}
  tmrPaused=true;updatePauseBtn();
}
function togglePause(){if(tmrPaused)resumeTimer();else pauseTimer()}
function stopTimer(){if(tmr){cancelAnimationFrame(tmr);tmr=null}tmrPaused=false;tmrRemaining=0;if(tmrEl){tmrEl.classList.remove('active','dead');tmrEl=null}updatePauseBtn()}
function updatePauseBtn(){const b=document.getElementById('pbtn');if(b)b.textContent=tmrPaused?'RESUME':'PAUSE'}

// ═════════════════════════════════════════
// TRANSITION MAP
// ═════════════════════════════════════════
function tx(type){
  switch(type){
    case'source_q':case'acronym_q':case'fluency_line':case'bonus_marker':return't-slam';
    case'source_a':case'acronym_a':case'fluency_source':case'doa_verdict_dead':case'doa_verdict_alive':return't-punch';
    case'round_title':case'verdict':case'intermission':case'last_line':case'endcard':return't-breath';
    case'receipt_rain':return't-shake';
    case'crate_drop':return't-fade';
    default:return't-fade';
  }
}

// ═════════════════════════════════════════
// RENDERERS
// ═════════════════════════════════════════
function e(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function fitText(el,maxW){if(!el)return;const w=el.scrollWidth;if(w>maxW){el.style.fontSize=(parseFloat(getComputedStyle(el).fontSize)*(maxW/w)*.97)+'px'}}

function qSz(t){const l=(t||'').length;if(l<=4)return'clamp(100px,22vw,280px)';if(l<=8)return'clamp(80px,16vw,220px)';if(l<=14)return'clamp(60px,12vw,170px)';if(l<=20)return'clamp(50px,9vw,130px)';return'clamp(36px,6vw,90px)'}
function aSz(t){const l=(t||'').length;if(l<=8)return'clamp(60px,11vw,160px)';if(l<=14)return'clamp(50px,9vw,130px)';if(l<=20)return'clamp(42px,7vw,100px)';if(l<=28)return'clamp(34px,5.5vw,80px)';if(l<=38)return'clamp(26px,4.2vw,62px)';if(l<=50)return'clamp(22px,3.3vw,48px)';return'clamp(16px,2.5vw,36px)'}
function nw(){return'white-space:nowrap;max-width:92%;padding:2vh 4%'}
function sb(t){return t?'<div class="srcbar">'+e(t)+'</div>':''}

const R={};
R.attract=s=>'<div class="D hp" style="font-size:clamp(120px,40vw,350px);animation:pulse 2s ease-in-out infinite">'+e(s.primary_text||'L')+'</div>';
R.fishbowl=s=>'<div class="nb nb-pk"></div><div class="D hp" style="font-size:clamp(32px,5vw,64px);margin-bottom:16px">'+e(s.primary_text)+'</div><div class="M hs" style="font-size:clamp(12px,1.8vw,22px)">'+e(s.secondary_text||'')+'</div>';
R.round_title=s=>'<div class="D hw" style="font-size:clamp(50px,10vw,150px);margin-bottom:10px">'+e(s.primary_text||'')+'</div>'+(s.secondary_text?'<div class="D hw fit" style="font-size:'+aSz(s.secondary_text)+';'+nw()+'">'+e(s.secondary_text)+'</div>':'');
R.tier_title=s=>{const ln=(s.secondary_text||'').split('|').map(l=>'<div>'+e(l.trim())+'</div>').join('');return'<div class="nb nb-wh"></div><div class="D hs" style="font-size:clamp(18px,2.5vw,32px);margin-bottom:8px;padding:0 5%">'+e(s.primary_text||'')+'</div><div class="rule"></div><div class="M" style="color:rgba(255,255,255,.5);font-size:clamp(11px,1.3vw,16px);line-height:2">'+ln+'</div>'};
R.bonus_marker=s=>'<div class="nb nb-gd"></div><div class="D hg" style="font-size:clamp(48px,8vw,120px)">'+e(s.primary_text||'')+'</div>';
R.source_q=s=>'<div class="nb nb-pk"></div><div class="tb pk"></div><div class="D hw fit" style="font-size:'+aSz(s.primary_text)+';'+nw()+'">'+e(s.primary_text||'')+'</div>';
R.source_a=s=>'<div class="nb nb-wh"></div><div class="D hw fit" style="font-size:'+aSz(s.primary_text)+';'+nw()+'">'+e(s.primary_text||'')+'</div>';
R.acronym_q=s=>'<div class="nb nb-cy"></div><div class="tb cy"></div><div class="D hw" style="font-size:'+qSz(s.primary_text)+';letter-spacing:.08em;'+nw()+'">'+e(s.primary_text||'')+'</div>'+sb(s.secondary_text);
R.acronym_a=s=>'<div class="nb nb-pk"></div><div class="D hw fit" style="font-size:'+aSz(s.primary_text)+';'+nw()+'">'+e(s.primary_text||'')+'</div>'+sb(s.secondary_text);
R.fluency_line=s=>'<div class="nb nb-wh"></div><div class="D hw fit" style="font-size:'+aSz(s.primary_text)+';'+nw()+'">'+e(s.primary_text||'')+'</div>';
R.fluency_source=s=>'<div class="D hw fit" style="font-size:'+aSz(s.primary_text)+';'+nw()+'">'+e(s.primary_text||'')+'</div>';
R.score=s=>'<div class="D hw" style="font-size:clamp(28px,4vw,56px)">'+e(s.primary_text||'')+'</div>'+(s.secondary_text?'<div class="M hs" style="font-size:clamp(12px,1.5vw,18px);margin-top:14px">'+e(s.secondary_text)+'</div>':'');
R.intermission=s=>'<div class="D hw" style="font-size:clamp(40px,7vw,100px);margin-bottom:20px">'+e(s.primary_text||'')+'</div><div class="M hs" style="font-size:clamp(14px,2vw,24px);margin-bottom:30px">'+e(s.secondary_text||'')+'</div><canvas id="qr" width="200" height="200" style="image-rendering:pixelated;width:160px;height:160px;border:4px solid rgba(255,255,255,.2)"></canvas><div class="M" style="color:rgba(255,255,255,.3);font-size:clamp(10px,1.2vw,14px);margin-top:12px;letter-spacing:.08em">SCAN TO VOTE : LINECONIC.LIVE/VOTE</div>';
R.doa_vote=s=>{const ref=e(s.primary_text||'');return'<div class="nb nb-wh"></div><div class="D hw" style="font-size:'+aSz(s.primary_text)+';'+nw()+';margin-bottom:30px">'+ref+'</div><div class="vote-bars" style="width:70%;max-width:600px"><div style="display:flex;justify-content:space-between;margin-bottom:8px"><span class="M" style="color:var(--pk);font-size:clamp(12px,1.5vw,18px);letter-spacing:.1em">DEAD</span><span class="M" style="color:var(--cy);font-size:clamp(12px,1.5vw,18px);letter-spacing:.1em">ALIVE</span></div><div style="width:100%;height:clamp(24px,4vh,40px);background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);position:relative;overflow:hidden"><div class="vbar-dead" style="position:absolute;left:0;top:0;bottom:0;width:50%;background:linear-gradient(90deg,var(--pk),rgba(255,0,127,.3));transition:width .6s cubic-bezier(.4,0,.2,1)"></div><div class="vbar-alive" style="position:absolute;right:0;top:0;bottom:0;width:50%;background:linear-gradient(270deg,var(--cy),rgba(0,255,255,.3));transition:width .6s cubic-bezier(.4,0,.2,1)"></div></div><div style="display:flex;justify-content:space-between;margin-top:8px"><span class="vpct-dead M" style="color:var(--pk);font-size:clamp(18px,3vw,36px)">50%</span><span class="vpct-alive M" style="color:var(--cy);font-size:clamp(18px,3vw,36px)">50%</span></div></div>';};
R.warning=s=>'<div class="D hw" style="font-size:clamp(60px,12vw,180px)">'+e(s.primary_text||'')+'</div>';
R.blackout=()=>'';
R.transition_beat=()=>'';
R.doa_ref=s=>'<div class="nb nb-wh"></div><div class="D hw fit" style="font-size:'+aSz(s.primary_text)+';'+nw()+'">'+e(s.primary_text||'')+'</div>';
R.doa_verdict_dead=s=>'<div class="nb nb-pk"></div><div class="D hp" style="font-size:clamp(80px,18vw,260px)">'+e(s.primary_text||'')+'</div>';
R.doa_verdict_alive=s=>'<div class="nb nb-cy"></div><div class="D hc" style="font-size:clamp(80px,18vw,260px)">'+e(s.primary_text||'')+'</div>';
R.hotseat_rules=s=>{const ln=(s.secondary_text||'').split('|').map(l=>'<div>'+e(l.trim())+'</div>').join('');return'<div class="nb nb-wh"></div><div class="D hw" style="font-size:clamp(24px,3.5vw,48px);margin-bottom:12px">'+e(s.primary_text||'')+'</div><div class="rule"></div><div class="M hs" style="font-size:clamp(14px,1.8vw,22px);line-height:2">'+ln+'</div>'};
R.hotseat_prompt=s=>'<div class="nb nb-cy"></div><div class="tb cy"></div><div class="D hc fit" style="font-size:'+aSz(s.primary_text)+';'+nw()+'">'+e(s.primary_text||'')+'</div>'+sb(s.secondary_text);
R.verdict=s=>'<div class="D hw" style="font-size:clamp(60px,12vw,180px)">'+e(s.primary_text||'')+'</div>';
R.sentence=s=>{const ln=(s.secondary_text||'').split('|').map(l=>'<div style="margin-bottom:8px">'+e(l.trim())+'</div>').join('');return'<div class="D hw" style="font-size:clamp(36px,6vw,80px);margin-bottom:20px">'+e(s.primary_text||'')+'</div><div class="M hs" style="font-size:clamp(14px,2vw,24px)">'+ln+'</div>'};
R.receipt_rain=s=>'<div class="D hp" style="font-size:clamp(50px,12vw,160px);animation:rain .8s ease-in-out infinite;z-index:4;position:relative">'+e(s.primary_text||'')+'</div>';
R.crate_drop=()=>'<div class="crate-container"><div class="crate"><div class="crate-lid"></div><div class="crate-body"><div class="crate-interior"><div class="crate-L">L</div></div></div></div></div>';
R.last_line=s=>'<div class="nb nb-wh"></div><div class="D hw fit" style="font-size:'+aSz(s.primary_text)+';'+nw()+'">'+e(s.primary_text||'')+'</div>';
R.endcard=s=>'<div class="D hp" style="font-size:clamp(100px,30vw,300px);margin-bottom:12px">'+e(s.primary_text||'L')+'</div><div class="M hs" style="font-size:clamp(12px,1.5vw,18px)">'+e(s.secondary_text||'')+'</div>';
R.answer_sheet=s=>{const items=(s.secondary_text||'').split('|').map(a=>{const isB=a.includes('[');return'<div class="'+(isB?'bonus':'')+'">'+e(a.trim())+'</div>'}).join('');return'<div class="nb nb-wh"></div><div class="D hw" style="font-size:clamp(20px,3vw,36px);margin-bottom:12px;padding-top:3%">'+e(s.primary_text||'')+'</div><div class="rule"></div><div class="ans-list">'+items+'</div>'};

// ═════════════════════════════════════════
// PARTICLE SYSTEM (Receipt Rain + Confetti)
// ═════════════════════════════════════════
const cvs=document.getElementById('particles');
const ctx=cvs.getContext('2d');
let parts=[],partAnim=null;

function resizeCvs(){cvs.width=window.innerWidth;cvs.height=window.innerHeight}
window.addEventListener('resize',resizeCvs);resizeCvs();

function spawnReceipts(count){
  parts=[];
  for(let i=0;i<count;i++){
    parts.push({
      x:Math.random()*cvs.width,
      y:-Math.random()*cvs.height*2,
      w:4+Math.random()*10,
      h:16+Math.random()*30,
      vy:1.5+Math.random()*3,
      vx:(Math.random()-.5)*1.2,
      rot:Math.random()*Math.PI*2,
      vr:(Math.random()-.5)*.06,
      a:.5+Math.random()*.5
    });
  }
}

function spawnFlutter(count){
  for(let i=0;i<count;i++){
    parts.push({
      x:Math.random()*cvs.width,
      y:-Math.random()*cvs.height*.5,
      w:3+Math.random()*6,
      h:12+Math.random()*20,
      vy:.3+Math.random()*.8,
      vx:(Math.random()-.5)*2,
      rot:Math.random()*Math.PI*2,
      vr:(Math.random()-.5)*.04,
      a:.3+Math.random()*.5
    });
  }
}

function tickParticles(){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  let alive=false;
  parts.forEach(p=>{
    p.x+=p.vx;p.y+=p.vy;p.rot+=p.vr;
    if(p.gravity){p.vy+=p.gravity;p.vx*=p.drag}
    if(p.y>cvs.height+60||p.y<-cvs.height*2.5){p.a*=.95}
    if(p.a<.01)return;
    alive=true;
    ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot);
    ctx.fillStyle=p.color||'rgba(255,0,127,'+p.a+')';
    ctx.globalAlpha=p.a;
    ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
    ctx.restore();
  });
  if(alive)partAnim=requestAnimationFrame(tickParticles);
  else{partAnim=null;parts=[];ctx.clearRect(0,0,cvs.width,cvs.height)}
}

function startParticles(type){
  if(partAnim){cancelAnimationFrame(partAnim);partAnim=null}
  parts=[];ctx.clearRect(0,0,cvs.width,cvs.height);
  if(type==='rain'){spawnReceipts(500);partAnim=requestAnimationFrame(tickParticles)}
  else if(type==='flutter'){spawnFlutter(80);partAnim=requestAnimationFrame(tickParticles)}
}
function stopParticles(){if(partAnim){cancelAnimationFrame(partAnim);partAnim=null}parts=[];ctx.clearRect(0,0,cvs.width,cvs.height)}

// ═════════════════════════════════════════
// FIREBASE INIT
// ═════════════════════════════════════════
// NOTE: If your database is NOT in us-central1, change databaseURL to:
// https://lineconic-live-default-rtdb.REGION.firebasedatabase.app
let fb=null,fbdb=null;
try{
  fb=firebase.initializeApp({
    apiKey:"AIzaSyC8ECLUReNM4JSkhRRuwTELmGTLWNVSrIE",
    authDomain:"lineconic-live.firebaseapp.com",
    databaseURL:"https://lineconic-live-default-rtdb.europe-west1.firebasedatabase.app",
    projectId:"lineconic-live",
    storageBucket:"lineconic-live.firebasestorage.app",
    messagingSenderId:"890189018310",
    appId:"1:890189018310:web:7cc55ce3f3833b14c6d3c7"
  });
  fbdb=firebase.database();
  console.log('Firebase connected');
}catch(e){console.warn('Firebase offline — using local votes',e)}

// ═════════════════════════════════════════
// DOA VOTING SYSTEM (Firebase-backed)
// ═════════════════════════════════════════
let votes={dead:0,alive:0};
let fbVoteRef=null;

function pushTopic(name){
  // Host pushes topic to Firebase — all phones see it instantly
  if(fbdb){
    fbdb.ref('currentTopic').set(name||null);
    // Start listening for votes on this topic
    const key=(name||'').replace(/[^a-zA-Z0-9]/g,'_');
    if(fbVoteRef){fbVoteRef.off();fbVoteRef=null}
    if(name){
      fbVoteRef=fbdb.ref('votes/'+key);
      fbVoteRef.on('value',snap=>{
        const v=snap.val()||{};
        votes.dead=v.dead||0;votes.alive=v.alive||0;
        updateVoteBars();
      });
    }
  }
}

function castVote(v){
  if(fbdb&&S[c]&&S[c].slide_type==='doa_vote'){
    const topic=S[c].primary_text||'';
    const key=topic.replace(/[^a-zA-Z0-9]/g,'_');
    fbdb.ref('votes/'+key+'/'+v).transaction(c=>(c||0)+1);
  }else{
    votes[v]++;
    updateVoteBars();
  }
  const btn=document.getElementById('v'+v);
  if(btn){btn.style.background='rgba(255,255,255,.3)';setTimeout(()=>{btn.style.background=''},150)}
}

function resetVotes(){
  votes={dead:0,alive:0};updateVoteBars();
  if(fbdb&&S[c]&&S[c].slide_type==='doa_vote'){
    const topic=S[c].primary_text||'';
    const key=topic.replace(/[^a-zA-Z0-9]/g,'_');
    fbdb.ref('votes/'+key).set({dead:0,alive:0});
  }
}

function updateVoteBars(){
  const total=votes.dead+votes.alive;
  const dp=total>0?Math.round(votes.dead/total*100):50;
  const ap=total>0?100-dp:50;
  // Update all visible vote bars (current slide)
  document.querySelectorAll('.vbar-dead').forEach(el=>{el.style.width=dp+'%'});
  document.querySelectorAll('.vbar-alive').forEach(el=>{el.style.width=ap+'%'});
  document.querySelectorAll('.vpct-dead').forEach(el=>{el.textContent=dp+'%'});
  document.querySelectorAll('.vpct-alive').forEach(el=>{el.textContent=ap+'%'});
  // Host panel
  const hv=document.getElementById('h-votes');
  if(hv)hv.textContent='DEAD: '+votes.dead+' | ALIVE: '+votes.alive+' | TOTAL: '+total;
}

// QR Code via qrcode-generator library
function drawQR(){
  const c=document.getElementById('qr');
  if(!c)return;
  const x=c.getContext('2d');
  const url='https://lineconic.live/vote/';
  const qr=qrcode(0,'L');
  qr.addData(url);
  qr.make();
  const sz=qr.getModuleCount();
  const px=Math.floor(200/sz);
  const off=Math.floor((200-sz*px)/2);
  x.fillStyle='#fff';x.fillRect(0,0,200,200);
  x.fillStyle='#000';
  for(let r=0;r<sz;r++)for(let cl=0;cl<sz;cl++){
    if(qr.isDark(r,cl))x.fillRect(off+cl*px,off+r*px,px,px);
  }
}

// ═════════════════════════════════════════
// BUILD DOM (lazy — empty shells only)
// ═════════════════════════════════════════
const dk=document.getElementById('deck');
S.forEach((s,i)=>{const d=document.createElement('div');d.className='S';d.id='s'+i;dk.appendChild(d)});

// Render a slide's content into its shell
function renderSlide(i){
  if(i<0||i>=t)return;
  const el=document.getElementById('s'+i);
  if(el.dataset.rendered)return;
  const r=R[S[i].slide_type];
  if(r)el.innerHTML=r(S[i]);
  el.dataset.rendered='1';
  // Fit text for this slide
  el.querySelectorAll('.fit').forEach(f=>{
    el.style.cssText='opacity:0;display:flex;pointer-events:none;position:absolute;inset:0';
    fitText(f,el.offsetWidth*.88);
    el.style.cssText='';
  });
}

// Unrender a slide to free memory (keep +/- 2 buffer)
function unrenderSlide(i){
  if(i<0||i>=t)return;
  const el=document.getElementById('s'+i);
  if(!el.dataset.rendered)return;
  el.innerHTML='';
  delete el.dataset.rendered;
}

// ═════════════════════════════════════════
// NAVIGATION
// ═════════════════════════════════════════
const ctr=document.getElementById('ctr'),sec=document.getElementById('sec');
const hType=document.getElementById('h-type'),hAns=document.getElementById('h-answer'),hNext=document.getElementById('h-next');

let autoTimer=false,autoAdv=false,autoSec=30;

function setDur(s){
  autoSec=s;
  document.querySelectorAll('.dur-btn').forEach(b=>{b.classList.toggle('active',parseInt(b.dataset.dur)===s)});
}

function go(n){
  if(n<0||n>=t)return;
  const prev=document.getElementById('s'+c);prev.classList.remove('on');prev.className='S';
  stopTimer();

  const oldC=c;
  c=n;

  // Lazy render: current + neighbors
  renderSlide(c);
  renderSlide(c+1);
  renderSlide(c+2);
  // Unrender distant slides (keep buffer of 3 each side)
  unrenderSlide(oldC-4);
  unrenderSlide(oldC+4);

  const cur=document.getElementById('s'+c);
  // Force reflow before animation
  cur.classList.add('on');
  void cur.offsetHeight;
  cur.classList.add(tx(S[c].slide_type));
  sfx(S[c].slide_type);
  // Particles
  stopParticles();
  if(S[c].slide_type==='receipt_rain')startParticles('rain');
  if(S[c].slide_type==='last_line'||S[c].slide_type==='endcard')startParticles('flutter');
  // QR code on intermission
  if(S[c].slide_type==='intermission')setTimeout(drawQR,100);
  // DOA voting: push topic to Firebase when entering doa_vote
  if(S[c].slide_type==='doa_vote'){
    votes={dead:0,alive:0};updateVoteBars();
    pushTopic(S[c].primary_text);
  }else if(S[c].slide_type==='doa_verdict_dead'||S[c].slide_type==='doa_verdict_alive'){
    // Keep topic active during verdict so phones see the result
  }else{
    // Clear topic when leaving DOA section
    if(fbdb&&fbVoteRef){pushTopic(null)}
  }
  ctr.textContent=(c+1)+'/'+t;
  sec.textContent=S[c].section||'';
  hType.textContent=S[c].slide_type+' | '+S[c].section;
  hAns.textContent=S[c].secondary_text||'';
  hNext.textContent=c+1<t?'NEXT: '+S[c+1].slide_type+' | '+(S[c+1].primary_text||'').substring(0,40):'END';
  // Auto-timer on question slides
  if(autoTimer&&['source_q','acronym_q','hotseat_prompt'].includes(S[c].slide_type)){startTimer(autoSec)}
}

// ═════════════════════════════════════════
// SCOREBOARD
// ═════════════════════════════════════════
let scores=[0,0],sbugOn=false;
const sc0=document.getElementById('sc0'),sc1=document.getElementById('sc1');
const si0=document.getElementById('si0'),si1=document.getElementById('si1');
const sbug=document.getElementById('sbug');
document.getElementById('u0').onclick=()=>{scores[0]=parseInt(si0.value)||0;sc0.textContent=scores[0]};
document.getElementById('u1').onclick=()=>{scores[1]=parseInt(si1.value)||0;sc1.textContent=scores[1]};
function toggleScore(){sbugOn=!sbugOn;sbug.classList.toggle('on',sbugOn);document.getElementById('stog').textContent=sbugOn?'HIDE SCOREBOARD':'SHOW SCOREBOARD'}
function toggleMute(){muted=!muted;if(muted)stopShepard();document.getElementById('mbtn').textContent=muted?'UNMUTE AUDIO':'MUTE AUDIO'}
function toggleAutoTimer(){autoTimer=!autoTimer;document.getElementById('atbtn').textContent='AUTO-TIMER: '+(autoTimer?'ON':'OFF');document.getElementById('atbtn').style.color=autoTimer?'var(--cy)':'var(--wh)'}
function toggleAutoAdv(){autoAdv=!autoAdv;document.getElementById('aabtn').textContent='AUTO-ADVANCE: '+(autoAdv?'ON':'OFF');document.getElementById('aabtn').style.color=autoAdv?'var(--cy)':'var(--wh)'}

// ═════════════════════════════════════════
// INPUT
// ═════════════════════════════════════════
const hp=document.getElementById('host');let hostOn=false;
document.addEventListener('keydown',ev=>{
  if(ev.target.tagName==='INPUT')return;
  switch(ev.key){
    case'ArrowRight':case' ':case'PageDown':ev.preventDefault();go(c+1);break;
    case'ArrowLeft':case'PageUp':ev.preventDefault();go(c-1);break;
    case'Home':go(0);break;case'End':go(t-1);break;
    case'f':case'F':if(!document.fullscreenElement)document.documentElement.requestFullscreen();else document.exitFullscreen();break;
    case'h':case'H':hostOn=!hostOn;hp.classList.toggle('on',hostOn);break;
    case's':case'S':toggleScore();break;
    case't':case'T':startTimer(autoSec);break;
    case'm':case'M':toggleMute();break;
    case'a':case'A':toggleAutoTimer();break;
    case'd':case'D':toggleAutoAdv();break;
    case'p':case'P':togglePause();break;
  }
});
document.addEventListener('click',ev=>{if(!hp.contains(ev.target)){initAudio();go(c+1)}});
document.addEventListener('contextmenu',ev=>{ev.preventDefault();go(c-1)});
let tch=0;document.addEventListener('touchstart',ev=>{tch=ev.touches[0].clientX});
document.addEventListener('touchend',ev=>{const dx=ev.changedTouches[0].clientX-tch;if(Math.abs(dx)>50){dx<0?go(c+1):go(c-1)}});
if(document.fonts){document.fonts.ready.then(()=>go(0))}else{setTimeout(()=>go(0),300)}
</script>
</body>
</html>
