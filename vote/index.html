<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LIVE VOTE</title>
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Space+Mono:wght@400;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;min-height:100vh;background:#000;font-family:'Anton','Impact',sans-serif;color:#fff;-webkit-font-smoothing:antialiased}
.wrap{max-width:420px;margin:0 auto;padding:40px 24px;text-align:center;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}
.logo{font-size:72px;color:#FF007F;text-shadow:0 0 10px rgba(255,0,127,.9),0 0 30px rgba(255,0,127,.5),0 0 60px rgba(255,0,127,.2);margin-bottom:8px;letter-spacing:.08em}
.sub{font-family:'Space Mono',monospace;font-size:10px;color:rgba(255,255,255,.3);letter-spacing:.15em;text-transform:uppercase;margin-bottom:48px}
.prompt{font-size:14px;font-family:'Space Mono',monospace;color:rgba(255,255,255,.5);letter-spacing:.1em;text-transform:uppercase;margin-bottom:24px}
.topic{font-size:clamp(36px,10vw,56px);text-transform:uppercase;letter-spacing:.04em;color:#fff;text-shadow:0 0 10px rgba(255,255,255,.6),0 0 30px rgba(255,255,255,.3);margin-bottom:40px;line-height:1.1;transition:all .3s}
.btns{display:flex;gap:16px;width:100%;margin-bottom:32px}
.btn{flex:1;padding:24px 16px;border:2px solid;font-family:'Anton',sans-serif;font-size:28px;letter-spacing:.08em;cursor:pointer;transition:all .15s;text-transform:uppercase;-webkit-tap-highlight-color:transparent;user-select:none;background:transparent}
.btn-dead{color:#FF007F;border-color:#FF007F;box-shadow:0 0 12px rgba(255,0,127,.3)}
.btn-dead:active,.btn-dead.flash{background:#FF007F;color:#000;box-shadow:0 0 30px rgba(255,0,127,.6)}
.btn-alive{color:#00FFFF;border-color:#00FFFF;box-shadow:0 0 12px rgba(0,255,255,.3)}
.btn-alive:active,.btn-alive.flash{background:#00FFFF;color:#000;box-shadow:0 0 30px rgba(0,255,255,.6)}
.btn.off{opacity:.15;pointer-events:none}
.bar-wrap{width:100%;margin-bottom:16px}
.bar-labels{display:flex;justify-content:space-between;margin-bottom:6px}
.bar-labels span{font-family:'Space Mono',monospace;font-size:11px;letter-spacing:.08em}
.dl{color:#FF007F}.al{color:#00FFFF}
.bar{width:100%;height:8px;background:rgba(255,255,255,.05);position:relative;overflow:hidden}
.bar-fill-dead{position:absolute;left:0;top:0;bottom:0;width:50%;background:linear-gradient(90deg,#FF007F,rgba(255,0,127,.3));transition:width .4s ease}
.bar-fill-alive{position:absolute;right:0;top:0;bottom:0;width:50%;background:linear-gradient(270deg,#00FFFF,rgba(0,255,255,.3));transition:width .4s ease}
.pcts{display:flex;justify-content:space-between}
.pcts span{font-size:clamp(24px,6vw,36px);font-family:'Space Mono',monospace}
.dp{color:#FF007F;text-shadow:0 0 8px rgba(255,0,127,.4)}
.ap{color:#00FFFF;text-shadow:0 0 8px rgba(0,255,255,.4)}
.status{font-family:'Space Mono',monospace;font-size:11px;color:rgba(255,255,255,.3);margin-top:24px;letter-spacing:.08em;text-transform:uppercase;min-height:20px}
.footer{font-family:'Space Mono',monospace;font-size:9px;color:rgba(255,255,255,.1);margin-top:40px;letter-spacing:.1em;text-transform:uppercase}
.waiting .topic{color:rgba(255,255,255,.15);font-size:clamp(20px,6vw,28px)}
.waiting .btns{opacity:.15;pointer-events:none}
.waiting .bar-wrap,.waiting .pcts{opacity:.1}
.pop{animation:pop .3s ease}
@keyframes pop{0%{transform:scale(1.05);opacity:.7}100%{transform:scale(1);opacity:1}}
</style>
</head>
<body>
<div class="wrap waiting" id="app">
  <div class="logo">L</div>
  <div class="sub">DEAD OR ALIVE</div>
  <div class="prompt">IS THIS CULTURALLY...</div>
  <div class="topic" id="topic">WAITING FOR HOST</div>
  <div class="btns">
    <div class="btn btn-dead" id="bd" onclick="vote('dead')">DEAD</div>
    <div class="btn btn-alive" id="ba" onclick="vote('alive')">ALIVE</div>
  </div>
  <div class="bar-wrap">
    <div class="bar-labels"><span class="dl">DEAD</span><span class="al">ALIVE</span></div>
    <div class="bar"><div class="bar-fill-dead" id="bfd"></div><div class="bar-fill-alive" id="bfa"></div></div>
  </div>
  <div class="pcts"><span class="dp" id="pdead">-</span><span class="ap" id="palive">-</span></div>
  <div class="status" id="status">WAITING FOR THE HOST TO START</div>
  <div class="footer">LINECONIC.COM</div>
</div>
<script>
// ══════════════════════════════════════════════
// FIREBASE
// ══════════════════════════════════════════════
// NOTE: If your database is NOT in us-central1, change databaseURL to:
// https://lineconic-live-default-rtdb.REGION.firebasedatabase.app
firebase.initializeApp({
  apiKey:"AIzaSyC8ECLUReNM4JSkhRRuwTELmGTLWNVSrIE",
  authDomain:"lineconic-live.firebaseapp.com",
  databaseURL:"https://lineconic-live-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"lineconic-live",
  storageBucket:"lineconic-live.firebasestorage.app",
  messagingSenderId:"890189018310",
  appId:"1:890189018310:web:7cc55ce3f3833b14c6d3c7"
});
const db=firebase.database();
let curTopic=null,myVote=null,vRef=null;

// ══════════════════════════════════════════════
// LISTEN: topic changes (host pushes these)
// ══════════════════════════════════════════════
db.ref('currentTopic').on('value',snap=>{
  const t=snap.val();
  if(t!==curTopic){curTopic=t;myVote=null;onTopic(t)}
});

function onTopic(t){
  const el=document.getElementById('topic'),app=document.getElementById('app');
  if(vRef){vRef.off();vRef=null}
  if(!t){
    el.textContent='WAITING FOR HOST';app.classList.add('waiting');
    document.getElementById('status').textContent='WAITING FOR THE HOST TO START';
    document.getElementById('bd').classList.remove('off');
    document.getElementById('ba').classList.remove('off');
    bars(0,0,false);return;
  }
  el.textContent=t;el.classList.remove('pop');void el.offsetHeight;el.classList.add('pop');
  app.classList.remove('waiting');
  document.getElementById('status').textContent='TAP TO VOTE';
  document.getElementById('bd').classList.remove('off');
  document.getElementById('ba').classList.remove('off');
  // Listen for live vote counts
  const key=t.replace(/[^a-zA-Z0-9]/g,'_');
  vRef=db.ref('votes/'+key);
  vRef.on('value',snap=>{const v=snap.val()||{};bars(v.dead||0,v.alive||0,true)});
}

// ══════════════════════════════════════════════
// VOTE (one per topic per session)
// ══════════════════════════════════════════════
function vote(v){
  if(myVote||!curTopic)return;myVote=v;
  const key=curTopic.replace(/[^a-zA-Z0-9]/g,'_');
  db.ref('votes/'+key+'/'+v).transaction(c=>(c||0)+1);
  const btn=document.getElementById(v==='dead'?'bd':'ba');
  btn.classList.add('flash');setTimeout(()=>btn.classList.remove('flash'),300);
  document.getElementById('bd').classList.add('off');
  document.getElementById('ba').classList.add('off');
  document.getElementById('status').textContent='VOTED: '+v.toUpperCase();
}

// ══════════════════════════════════════════════
// UI
// ══════════════════════════════════════════════
function bars(dead,alive,show){
  const tot=dead+alive;
  const dp=tot>0?Math.round(dead/tot*100):50;
  const ap=tot>0?100-dp:50;
  document.getElementById('bfd').style.width=(show?dp:50)+'%';
  document.getElementById('bfa').style.width=(show?ap:50)+'%';
  document.getElementById('pdead').textContent=show&&tot>0?dp+'%':'-';
  document.getElementById('palive').textContent=show&&tot>0?ap+'%':'-';
}
</script>
</body>
</html>
